@ECHO OFF
SETLOCAL ENABLEDELAYEDEXPANSION
SET PATH_BUILDER=%~1
SET PROCESS=%~2
SET TEXT=%~3
SET TYPE=%~4
SET INICIO=INICIO
SET INICIO_TMP=INICIO_TMP
SET FIM=FIM
SET SUCESSO=SUCESSO
SET INFORMACAO=INFORMACAO
SET ERRO=ERRO
SET LOG=log
SET TMP=tmp


::TYPE=0 IS FOR CREATE NEW LOG FILE INTO LOG FILE
IF ["%TYPE%"]==["0"] (
	CALL :LOGAR %INICIO%
	EXIT 0
)
::TYPE=1 IS FOR LOG A ERROR INTO LOG FILE
IF ["%TYPE%"]==["1"] (
	CALL :LOGAR %ERRO%
	EXIT 0	
)
::TYPE=2 IS FOR LOG A ERROR INTO TMP FILE
IF ["%TYPE%"]==["2"] (
	CALL :LOGAR %SUCESSO%
	EXIT 0	
)
IF ["%TYPE%"]==["3"] (
	CALL :LOGAR %INFORMACAO%
	EXIT 0	
)
IF ["%TYPE%"]==["4"] (
	CALL :LOGAR %FIM%
	EXIT 0	
)
IF ["%TYPE%"]==["5"] (
	CALL :LOGAR %INICIO_TMP%
	EXIT 0
)


::TYPE=10 IS USED TO VERIFY IF THERE IS A [ERRO] IN THE LOG FILE
IF ["%TYPE%"]==["10"] (
	CALL :VERIFICAR %LOG% %ERRO%
	ECHO LOGGER - VERIFICACAO RETORNOU: %ERRORLEVEL%
	EXIT %ERRORLEVEL%
)
::TYPE=11 IS USED TO VERIFY IF THERE IS A [ERRO] IN THE TMP FILE
IF ["%TYPE%"]==["11"] (
	CALL :VERIFICAR %TMP% %ERRO%
	ECHO LOGGER - VERIFICACAO RETORNOU: %ERRORLEVEL%
	EXIT %ERRORLEVEL%
)
::TYPE=12 IS USED TO VERIFY IF THERE IS A [INFORMACAO] IN THE LOG FILE
IF ["%TYPE%"]==["12"] (
	CALL :VERIFICAR %LOG% %INFORMACAO%
	ECHO LOGGER - VERIFICACAO RETORNOU: %ERRORLEVEL%
	EXIT %ERRORLEVEL%
)
::TYPE=13 IS USED TO VERIFY IF THERE IS A [INFORMACAO] IN THE TMP FILE
IF ["%TYPE%"]==["13"] (
	CALL :VERIFICAR %TMP% %INFORMACAO%
	ECHO LOGGER - VERIFICACAO RETORNOU: %ERRORLEVEL%
	EXIT %ERRORLEVEL%
)
::TYPE=20 IS USED TO VERIFY IF THERE IS A PARAM TEXT IN THE LOG FILE
IF ["%TYPE%"]==["20"] (
	CALL :VERIFICAR %LOG% "%TEXT%"
	ECHO LOGGER - VERIFICACAO RETORNOU: %ERRORLEVEL%
	EXIT %ERRORLEVEL%
)
::TYPE=21 IS USED TO VERIFY IF THERE IS A PARAM TEXT IN THE TMP FILE
IF ["%TYPE%"]==["21"] (
	CALL :VERIFICAR %TMP% "%TEXT%"
	ECHO LOGGER - VERIFICACAO RETORNOU: %ERRORLEVEL%
	EXIT %ERRORLEVEL%
)
::TYPE=30 IS USED TO VERIFY IF THERE IS A PARAM TEXT IN THE TMP FILE
IF ["%TYPE%"]==["30"] (
	CALL :LOGAR_TMP %TMP%
	EXIT 0
)


:LOGAR 
SET ACTION=%~1
IF ["%ACTION%"]==["%INICIO%"] (
	echo %DATE% %TIME% - %PROCESS% - %ACTION%
	echo %DATE% %TIME% - %PROCESS% - %ACTION% > %PATH_BUILDER%\%LOG%\%PROCESS%.%LOG%
	echo %DATE% %TIME% - %PROCESS% - %ACTION% > %PATH_BUILDER%\%TMP%\%PROCESS%.%TMP%
	EXIT /B 0
)
IF ["%ACTION%"]==["%INICIO_TMP%"] (
	echo %DATE% %TIME% - %PROCESS% - %ACTION%
	echo %DATE% %TIME% - %PROCESS% - %ACTION% > %PATH_BUILDER%\%TMP%\%PROCESS%.%TMP%
	EXIT /B 0
)
IF ["%ACTION%"]==["%FIM%"] (
	echo %DATE% %TIME% - %PROCESS% - %ACTION%
	echo %DATE% %TIME% - %PROCESS% - %ACTION% >> %PATH_BUILDER%\%LOG%\%PROCESS%.%LOG%
	echo %DATE% %TIME% - %PROCESS% - %ACTION% >> %PATH_BUILDER%\%TMP%\%PROCESS%.%TMP%
	EXIT /B 0
)
echo %DATE% %TIME% - %PROCESS% - %ACTION% - %TEXT% 
echo %DATE% %TIME% - %PROCESS% - %ACTION% - %TEXT% >> %PATH_BUILDER%\%LOG%\%PROCESS%.%LOG%
echo %DATE% %TIME% - %PROCESS% - %ACTION% - %TEXT% >> %PATH_BUILDER%\%TMP%\%PROCESS%.%TMP%
EXIT /B 0

:VERIFICAR
SET ARCHIVE_TYPE=%~1
SET SEARCHTERM=%~2
echo %DATE% %TIME% - %PROCESS% - %INFORMACAO% - VERIFICANDO SE EXISTE TERMO NO ARQUIVO %PROCESS%.%ARCHIVE_TYPE%
for /f "delims=" %%k in ('findstr "%SEARCHTERM%" %PATH_BUILDER%\%ARCHIVE_TYPE%\%PROCESS%.%ARCHIVE_TYPE%') do (
	echo %DATE% %TIME% - %PROCESS% - %ERRO% - TERMO %SEARCHTERM% ENCONTRADO NA LINHA: %%k
	echo %DATE% %TIME% - %PROCESS% - %ERRO% - TERMO %SEARCHTERM% ENCONTRADO NA LINHA: %%k >> %PATH_BUILDER%\%LOG%\%PROCESS%.%LOG%
	echo %DATE% %TIME% - %PROCESS% - %ERRO% - TERMO %SEARCHTERM% ENCONTRADO NA LINHA: %%k >> %PATH_BUILDER%\%TMP%\%PROCESS%.%TMP%
	EXIT 1
)	
echo %DATE% %TIME% - %PROCESS% - %SUCESSO% - TERMO NAO ENCONTRADO 
echo %DATE% %TIME% - %PROCESS% - %SUCESSO% - TERMO NAO ENCONTRADO >> %PATH_BUILDER%\%LOG%\%PROCESS%.%LOG%
echo %DATE% %TIME% - %PROCESS% - %SUCESSO% - TERMO NAO ENCONTRADO >> %PATH_BUILDER%\%TMP%\%PROCESS%.%TMP%
EXIT 0

:LOGAR_TMP
for /f "delims=" %%k in ('type %PATH_BUILDER%\%TMP%\%PROCESS%.%TMP%') do (
	echo %DATE% %TIME% - %PROCESS% - %%k >> %PATH_BUILDER%\%LOG%\%PROCESS%.%LOG%
)
EXIT /B 0

